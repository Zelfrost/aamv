{% extends "@AppBundle/Base/base.html.twig" %}

{% block title %}Modifier mon compte - {{ parent() }}{% endblock %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/app/css/Base/login.css') }}">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css">
{% endblock css %}

{% block body %}
    <h2 class="main">Modifier mon compte</h2>

    <h3>Profil de {{ app.user.userIdentifier }}</h3>

    {% for flash in app.session.flashbag.get('management.account.success') %}
        <div class="alert alert-success">{{ flash }}</div>
    {% endfor %}

    {{ form(form) }}

    <hr>

    <h3>Mes données personnelles (RGPD)</h3>

    <div class="row">
        <div class="col-md-6 mb-2 mb-md-0">
            <a href="{{ path('manage_account_export') }}" class="btn btn-info w-100">
                <i class="bi bi-download"></i> Exporter mes données
            </a>
        </div>
        <div class="col-md-6">
            <button type="button" class="btn btn-danger w-100" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
                <i class="bi bi-trash"></i> Supprimer mon compte
            </button>
        </div>
    </div>

    <div class="modal fade" id="deleteAccountModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Supprimer mon compte</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Attention, cette action est irréversible !</strong>
                    </div>
                    <p>La suppression de votre compte entraînera la suppression définitive de :</p>
                    <ul>
                        <li>Toutes vos <strong>annonces</strong></li>
                        <li>Toutes vos <strong>disponibilités</strong></li>
                        <li>Toutes vos <strong>actualités</strong> publiées</li>
                        <li>Toutes vos <strong>données personnelles</strong></li>
                    </ul>
                    <p>Aucun retour en arrière ne sera possible.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <form method="post" action="{{ path('manage_account_delete') }}" style="display: inline;">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete_account') }}">
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-trash"></i> Confirmer la suppression
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <span id="cities-api-url" data-url="{{ path('api_cities', {name: '__SEARCH__'}) }}"></span>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/i18n/fr.js"></script>
    <script src="{{ asset('bundles/app/js/cities.js') }}"></script>
{% endblock javascripts %}
