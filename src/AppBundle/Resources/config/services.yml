services:
    listener.legacy_authentication:
        class: AppBundle\Listener\LegacyAuthenticationListener
        arguments: ['@security.token_storage', '@session', '@security.password_encoder', '@doctrine']
        tags:
            - { name: kernel.event_listener, event: security.interactive_login }

    converter.csv_to_array:
        class: AppBundle\Service\Converter\CsvToArrayConverter

    password_encoder.legacy:
        class: AppBundle\Service\PasswordEncoder\LegacyPasswordEncoder
        arguments: ['@doctrine.orm.entity_manager']

    buzz.client.curl:
        class:  Buzz\Client\Curl
        public: false
        calls:
            - ['setVerifyPeer', [false]]

    buzz.browser:
        class:     Buzz\Browser
        arguments: ['@buzz.client.curl']

    form.register:
        class: AppBundle\Form\Type\RegisterType
        arguments: ['@retriever.city']
        tags:
            - { name: form.type }

    form.tool:
        class: AppBundle\Form\Type\ToolType
        tags:
            - { name: form.type }

    form.person:
        class: AppBundle\Form\Type\PersonType
        arguments: ['@retriever.city']
        tags:
            - { name: form.type }

    form.profile:
        class: AppBundle\Form\Type\ProfileType
        tags:
            - { name: form.type }

    form.login:
        class: AppBundle\Form\Type\LoginType
        tags:
            - { name: form.type }

    form.change_password:
        class: AppBundle\Form\Type\ChangePasswordType
        arguments: [ '@security.password_encoder' ]
        tags:
            - { name: form.type }

    retriever.city:
        class: AppBundle\Service\Retriever\CityRetriever
        arguments: ['@buzz.browser', '%api_city_login%', '%api_city_key%']

    retriever.role:
        class: AppBundle\Service\Retriever\RoleRetriever
        arguments: ['@security.authorization_checker']

    retriever.publishable:
        class: AppBundle\Service\Retriever\PublishableRetriever
        arguments: ['@doctrine.orm.entity_manager']

    city_from_api:
        class: AppBundle\Service\Validator\Constraints\CityFromApiValidator
        arguments: ['@retriever.city']
        tags:
            - { name: validator.constraint_validator, alias: city_from_api }

    mailer.registration:
        class: AppBundle\Service\Mailer\RegistrationMailer
        arguments: ['@twig', '@mailer']
        calls:
            - ['setLogger', ['@logger']]